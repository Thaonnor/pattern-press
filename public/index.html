<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Press</title>
    <link rel="stylesheet" href="recipe_viewer_styles.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Modular JavaScript Files -->
    <script src="js/utils.js"></script>
    <script src="js/recipe-parsers.js"></script>
    <script src="js/recipe-components.js"></script>
    <script src="js/app.js"></script>
</head>
<body>
    <div class="container">
        <div x-data="app()" x-init="loadRecipes(); setupKeyboardNavigation()" @keydown.window="handleKeydown($event)">
            <div class="header">
                <h1>Pattern Press</h1>
                <p>KubeJS Recipe Browser & Analysis Tool</p>
            </div>

        <div class="controls sticky-filters">
            <div class="filter-section">
                <label for="mod">Mod:</label>
                <select id="mod" x-model="selectedMod" @change="filterRecipes()"
                        aria-label="Filter recipes by mod">
                    <option value="">All Mods</option>
                    <template x-for="mod in availableMods" :key="mod">
                        <option :value="mod" x-text="mod"></option>
                    </template>
                </select>

                <label for="recipeType">Recipe Type:</label>
                <select id="recipeType" x-model="selectedRecipeType" @change="filterRecipes()"
                        aria-label="Filter recipes by type">
                    <option value="">All Types</option>
                    <template x-for="type in availableRecipeTypes" :key="type">
                        <option :value="type" x-text="type"></option>
                    </template>
                </select>
            </div>

            <p><strong>All Recipes:</strong> <span x-text="totalRecipes"></span> total (<span x-text="filteredRecipes.length"></span> filtered)</p>
            <p>Showing <span x-text="paginatedRecipes.length"></span> recipes (Page <span x-text="currentPage"></span> of <span x-text="totalPages"></span>)</p>
            <div class="keyboard-hint">
                <kbd>/</kbd> focus search • <kbd>←/→</kbd> navigate pages • <kbd>j/k</kbd> move through recipes
            </div>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="loading">
            <p>Loading recipes...</p>
        </div>

        <!-- Recipe List -->
        <div x-show="!loading" class="recipes">
            <template x-for="recipe in paginatedRecipes" :key="recipe.id">
                <div class="recipe-card">
                    <div class="recipe-header">
                        <h3 class="recipe-title" x-text="formatName(recipe.name)"></h3>
                        <div class="recipe-header-badges">
                            <span class="chip chip-mod"><span class="badge-label">Mod:</span> <span x-text="recipe.mod"></span></span>
                            <span class="chip chip-type" :data-type="recipe.type"><span class="badge-label">Type:</span> <span x-text="recipe.type"></span></span>
                        </div>
                    </div>
                    <div class="recipe-subheader" x-data="recipeMetadata(recipe)">
                        <span class="chip id"
                              x-data="clipboardComponent()"
                              @click="copyText(getCanonicalName(recipe))"
                              title="Click to copy recipe ID"
                              role="button"
                              tabindex="0"
                              @keydown.enter="copyText(getCanonicalName(recipe))"
                              @keydown.space="copyText(getCanonicalName(recipe))">
                              <span x-show="!copied">ID: <span x-text="getCanonicalName(recipe)"></span></span>
                              <span x-show="copied">✓ Copied!</span>
                        </span>
                        <span class="chip chip-metadata time" x-show="cookingTime"><span class="badge-label">Time:</span> <span x-text="cookingTime + ' ticks'"></span></span>
                        <span class="chip chip-metadata xp" x-show="experience"><span class="badge-label">XP:</span> <span x-text="experience + ' XP'"></span></span>
                    </div>
                    <div class="recipe-visualization">
                        <!-- Shaped Crafting Grid View -->
                        <div x-show="recipe.type === 'minecraft:crafting_shaped'" x-data="craftingGrid(recipe)" class="recipe-layout crafting-layout">
                            <div class="crafting-grid">
                                <template x-for="(slot, index) in gridSlots" :key="index">
                                    <div :class="getSlotClasses(slot)">
                                        <span x-text="slot ? slot.text : ''"></span>
                                        <div class="mod-overlay" x-show="slot" x-text="slot ? slot.modText : ''"></div>
                                    </div>
                                </template>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item slot--output">
                                <span x-text="resultText"></span>
                                <div class="mod-overlay" x-text="resultModText"></div>
                            </div>
                        </div>

                        <!-- Smelting/Blasting/Smoking/Stonecutting/Campfire/Color Change Recipe View -->
                        <div x-show="recipe.type === 'minecraft:smelting' || recipe.type === 'minecraft:blasting' || recipe.type === 'minecraft:smoking' || recipe.type === 'minecraft:stonecutting' || recipe.type === 'minecraft:campfire_cooking' || recipe.type === 'actuallyadditions:color_change'" x-data="smeltingGrid(recipe)" class="recipe-layout simple-layout">
                            <div :class="getSlotClasses(inputSlot)">
                                <span x-text="inputSlot ? inputSlot.text : 'No Input'"></span>
                                <div class="mod-overlay" x-show="inputSlot" x-text="inputSlot ? inputSlot.modText : ''"></div>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item slot--output">
                                <span x-text="resultText"></span>
                                <div class="mod-overlay" x-text="resultModText"></div>
                            </div>
                        </div>

                        <!-- Coffee Ingredient Recipe View -->
                        <div x-show="recipe.type === 'actuallyadditions:coffee_ingredient'" x-data="coffeeIngredientGrid(recipe)" class="recipe-layout simple-layout">
                            <div :class="getSlotClasses(inputSlot)">
                                <span x-text="inputSlot ? inputSlot.text : 'No Input'"></span>
                                <div class="mod-overlay" x-show="inputSlot" x-text="inputSlot ? inputSlot.modText : ''"></div>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item slot--output effect-result">
                                <span x-text="resultText"></span>
                                <div class="mod-overlay" x-text="resultModText"></div>
                            </div>
                        </div>

                        <!-- Crushing Recipe View -->
                        <div x-show="recipe.type === 'actuallyadditions:crushing'" x-data="crushingGrid(recipe)" class="recipe-layout crushing-layout">
                            <div :class="getSlotClasses(inputSlot)">
                                <span x-text="inputSlot ? inputSlot.text : 'No Input'"></span>
                                <div class="mod-overlay" x-show="inputSlot" x-text="inputSlot ? inputSlot.modText : ''"></div>
                            </div>
                            <span class="arrow">→</span>
                            <div class="crushing-results">
                                <div class="result-item slot--output">
                                    <span x-text="resultText"></span>
                                    <div class="mod-overlay" x-text="resultModText"></div>
                                </div>
                                <div x-show="secondaryResult" class="result-item slot--output secondary-result">
                                    <span x-text="secondaryResult ? secondaryResult.text : ''"></span>
                                    <div class="mod-overlay" x-text="secondaryResult ? secondaryResult.modText : ''"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Shapeless Crafting Recipe View -->
                        <div x-show="recipe.type === 'minecraft:crafting_shapeless'" x-data="shapelessGrid(recipe)" class="recipe-layout shapeless-layout">
                            <div class="ingredient-grid">
                                <template x-for="(ingredient, index) in ingredients" :key="index">
                                    <div :class="getSlotClasses(ingredient)">
                                        <span x-text="ingredient ? ingredient.text : 'Empty'"></span>
                                        <div class="mod-overlay" x-show="ingredient" x-text="ingredient ? ingredient.modText : ''"></div>
                                    </div>
                                </template>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item slot--output">
                                <span x-text="resultText"></span>
                                <div class="mod-overlay" x-text="resultModText"></div>
                            </div>
                        </div>

                        <!-- Smithing Recipe Views (Legacy, Transform, Trim) -->
                        <div x-show="recipe.type === 'minecraft:smithing'" x-data="smithingGrid(recipe)" class="recipe-layout smithing-layout">
                            <div class="smithing-inputs">
                                <div :class="getSlotClasses(templateSlot)">
                                    <span x-text="templateSlot ? templateSlot.text : 'Template'"></span>
                                    <div class="mod-overlay" x-show="templateSlot" x-text="templateSlot ? templateSlot.modText : ''"></div>
                                </div>
                                <div :class="getSlotClasses(baseSlot)">
                                    <span x-text="baseSlot ? baseSlot.text : 'Base'"></span>
                                    <div class="mod-overlay" x-show="baseSlot" x-text="baseSlot ? baseSlot.modText : ''"></div>
                                </div>
                                <div :class="getSlotClasses(additionSlot)">
                                    <span x-text="additionSlot ? additionSlot.text : 'Addition'"></span>
                                    <div class="mod-overlay" x-show="additionSlot" x-text="additionSlot ? additionSlot.modText : ''"></div>
                                </div>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item slot--output">
                                <span x-text="resultText"></span>
                                <div class="mod-overlay" x-text="resultModText"></div>
                            </div>
                        </div>

                        <!-- Smithing Transform Recipe View -->
                        <div x-show="recipe.type === 'minecraft:smithing_transform'" x-data="smithingTransformGrid(recipe)" class="recipe-layout smithing-layout">
                            <div class="smithing-inputs">
                                <div :class="getSlotClasses(templateSlot)">
                                    <span x-text="templateSlot ? templateSlot.text : 'Template'"></span>
                                    <div class="mod-overlay" x-show="templateSlot" x-text="templateSlot ? templateSlot.modText : ''"></div>
                                </div>
                                <div :class="getSlotClasses(baseSlot)">
                                    <span x-text="baseSlot ? baseSlot.text : 'Base'"></span>
                                    <div class="mod-overlay" x-show="baseSlot" x-text="baseSlot ? baseSlot.modText : ''"></div>
                                </div>
                                <div :class="getSlotClasses(additionSlot)">
                                    <span x-text="additionSlot ? additionSlot.text : 'Addition'"></span>
                                    <div class="mod-overlay" x-show="additionSlot" x-text="additionSlot ? additionSlot.modText : ''"></div>
                                </div>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item slot--output">
                                <span x-text="resultText"></span>
                                <div class="mod-overlay" x-text="resultModText"></div>
                            </div>
                        </div>

                        <!-- Smithing Trim Recipe View -->
                        <div x-show="recipe.type === 'minecraft:smithing_trim'" x-data="smithingTrimGrid(recipe)" class="recipe-layout smithing-layout">
                            <div class="smithing-inputs">
                                <div :class="getSlotClasses(templateSlot)">
                                    <span x-text="templateSlot ? templateSlot.text : 'Trim Pattern'"></span>
                                    <div class="mod-overlay" x-show="templateSlot" x-text="templateSlot ? templateSlot.modText : ''"></div>
                                </div>
                                <div :class="getSlotClasses(baseSlot)">
                                    <span x-text="baseSlot ? baseSlot.text : 'Armor'"></span>
                                    <div class="mod-overlay" x-show="baseSlot" x-text="baseSlot ? baseSlot.modText : ''"></div>
                                </div>
                                <div :class="getSlotClasses(additionSlot)">
                                    <span x-text="additionSlot ? additionSlot.text : 'Trim Material'"></span>
                                    <div class="mod-overlay" x-show="additionSlot" x-text="additionSlot ? additionSlot.modText : ''"></div>
                                </div>
                            </div>
                            <span class="arrow">→</span>
                            <div class="result-item trimmed-armor-result">
                                <span>Trimmed Armor</span>
                            </div>
                        </div>

                        <!-- Unsupported Recipe Types -->
                        <div x-show="!isSupportedRecipeType(recipe.type)" class="unsupported-recipe">
                            <p>Recipe visualization coming soon for <span x-text="recipe.type"></span></p>
                        </div>
                    </div>

                    <!-- JSON Toggle Section -->
                    <div class="recipe-actions" x-data="jsonToggleComponent()">
                        <div class="json-header">
                            <div class="json-toggle" @click="toggleJson()" x-text="showJson ? 'Hide Raw JSON' : 'Show Raw JSON'"></div>
                            <span class="chip chip-copy"
                                  x-show="showJson"
                                  x-data="clipboardComponent()"
                                  @click="copyText(JSON.stringify(recipe.data, null, 2))"
                                  title="Copy JSON to clipboard">
                                <span x-show="!copied">📋 Copy JSON</span>
                                <span x-show="copied">✓ Copied!</span>
                            </span>
                        </div>
                        <div x-show="showJson" class="json-content">
                            <pre x-text="JSON.stringify(recipe.data, null, 2)"></pre>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Pagination -->
        <div x-show="!loading && totalPages > 1" class="pagination">
            <button @click="prevPage()" :disabled="currentPage === 1">Previous</button>
            <span x-text="`Page ${currentPage} of ${totalPages}`"></span>
            <button @click="nextPage()" :disabled="currentPage === totalPages">Next</button>
        </div>
        </div>
    </div>
</body>
</html>